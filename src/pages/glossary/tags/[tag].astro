---
import TaxonLayout from "@components/glossary/TaxonLayout.astro";
import { getTaxonomy } from "@lib/taxonomyParser";
import { getEntries } from "@lib/contentParser";
import { sortByDate } from "@lib/sortFunctions";
import { slugify } from "@lib/textConverter";

export async function getStaticPaths() {
  const collection = "glossary";
  const taxonomy = "tags";
  const tags = await getTaxonomy(collection, taxonomy);
  
  return tags.map((tag) => {
    return {
      params: { tag: slugify(tag) },
    };
  });
}

const { tag } = Astro.params;
const entries = await getEntries("glossary", sortByDate);
const posts = entries.filter((item: any) => {
  const tags = item.data.tags?.map((t: string) => slugify(t)) || [];
  return tags.includes(tag);
});
---

<TaxonLayout taxonomy="tags" taxon={tag} entries={posts} collection="glossary" />
