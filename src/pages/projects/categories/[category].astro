---
import TaxonLayout from "@components/projects/TaxonLayout.astro";
import { getTaxa } from "@lib/taxonomyParser";
import { getEntries } from "@lib/contentParser";
import { sortByDate } from "@lib/sortFunctions";
import { slugify } from "@lib/textConverter";

export async function getStaticPaths() {
  const collection = "projects";
  const taxonomy = "categories";
  const categories = await getTaxa(collection, taxonomy);
  
  return categories.map((category) => {
    return {
      params: { category: slugify(category) },
    };
  });
}

const { category } = Astro.params;
const entries = await getEntries("projects", sortByDate);
const posts = entries.filter((item: any) => {
  const categories = item.data.categories?.map((c: string) => slugify(c)) || [];
  return categories.includes(category);
});
---

<TaxonLayout taxonomy="categories" taxon={category} entries={posts} collection="projects" />
